### 大型网站架构要求
- 高可用（四个9）
- 高性能（响应速度）（大流量，pv，uv）
- 易扩展（功能）
- 可伸缩（机器）
- 安全性

问题 | 演进过程
---|---
初始 | lamp一台服务器
数据量增大，存储空间不足| 应用服务和数据服务分离
数据访问压力过大 | 缓存
业务需求压力大 | 服务器集群
数据库压力 | 数据库读写分离
响应速度慢 | cdn & 反向代理
存储 | 分布式文件系统和数据库系统
搜索&查询 | nosql&搜索引擎
业务复杂 | 业务拆分
业务复杂 | 分布式服务



### 模式
- 分层（应用层：服务层：数据层）
- 分割（竖向拆分，根据业务）
- 分布式
> 分布式应用和服务；分布式静态资源；分布式数据和存储；分布式计算；分布式锁；
- 集群
- 缓存（cdn | 反向代理 | 本地缓存 | 分布式缓存）
- 异步
- 冗余
- 自动化



### 高性能
- web端优化
- 服务器优化（缓存&集群&异步&代码）
- 存储性能优化（RAID & HDFS）


##### 多线程
- 原因：io阻塞和多CPU 
- 目的：最大限度的利用cpu资源


### 高可用
- 数据和服务的冗余
- 失效转移

##### 应用层高可用
- 服务无状态：多个服务实例之间完全对等
- session管理（有状态）

##### session管理
- session复制
- session绑定，也称为会话粘滞，session哈希，缺点：不高可用
- cookie存储session，缺点：大小受限制；影响性能；用户关闭cookie就会访问不正常
- session服务器：最优。单点登录SSO等

### 高可用服务
- 同应用层
- ==分级管理==，避免故障的连锁反应，低优先级的服务部署在不同的线程或者虚拟机上，高优先级的部署在不同的物理机上
- ==超时设置==
- ==异步调用==，避免一个服务多个步骤，因为一个步骤引起的失败
- ==服务熔断和降级==
- ==幂等性设计==


### 高可用数据
- 数据备份
- 失效转移
- 缓存，多个服务共享缓存集群

### CAP原理
- 一致性 consistency：所有应用程序都能访问得到相同的数据
- 可用性 availibility：任何时候，任何应用程序都可以读写访问
- 伸缩性 partition tolerance：系统可以跨网络分区线性伸缩

##### 数据一致性
- 强一致：各个副本的数据在物理存储中一致
- 用户一致：用户获取的一致
- 最终一致：经过一段时间的自我修复和修正，数据达到最终一致

##### 数据备份
- 冷备
- 热备：异步热备&同步热备





